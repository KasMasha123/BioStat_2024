---
title: "Рабочий ноутбук для выполнения заданий вводного курса по R"
author: "Касьянова Мария"
date: '2024-09-09'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Загрузка библиотек и пакетов

```{r, message = FALSE}
library(tidyverse)
library(dplyr)
library(tibble)
```
## Чтение файлов

Загрузим датасет, с которым будем работать в дальнейшем, и посмотрим, как он выглядит.

```{r, message = FALSE}
data <- read_tsv("data_tsv.tsv")
data
```


## Рассчет базовых статистик

Для решения нескольких заданий курса необходимо вычислить для данных наборов чисел такие статистики, как среднее, медиана, квантили, дисперсия, минимальное и максимальное значение, стандартное отклонение и интерквартильный разброс:

```{r, message = FALSE}
mean(c(-19, -9, 19, 5, -14, 0, 34, -8, 34, 24, -11, 8, 33, 12, -6), na.rm = T)

median(c(19, 89, 78, 38, 8, 17, 25, 60, 8, 43, 29, 6, 62, 41, 69, 97, 61, 83, 25, 24))
median(c(-91, -33, 13, 34, 34, 75, -80, -35, -90, -72, 70, 67, -100, -94, -18))
median(c(1, 9, NA, 88, 2, NA, 42, NA, 4, 68, NA), na.rm = T)

min(c(17.24, 35.77, 57.57, 30.15, 43.27, 77.56, 72.19, 40.45, 46.2, 39.92))
min(c(90.48, 31.16, 44.4, 21.94, 84.37, 53.15, 81.15, 47.86, 63.23, 46.75, 102.73))
min(c(48.11, 45.3, 58.42, 51.64, 62.07, 57.26, 49.69, 93.29, 81.18, 44.78, 55.1, 76.74, 58.08))
min(c(60.22, 31.91, 72.71, 52.49, 46.21, 60.39, 60.09))

quantile(c(80.94, 44.46, 46.33, 65.1, 66.42, 104.43, 53.15, 48.41, 12.88, 51.1, 43.03, 40.3, 33.71, 55.1, 22.17))
quantile(c(26.17, 97.73, 24.81, 53.62, 87.72, 45.19, 45.7, 69.63, 36.76, 7.17))
quantile(c(63.92, 35.85, 26.9, 48.92, 43.1, 66.94, 47.06, 56.54, 29.1, 58.88))
quantile(c(32.05, 93.85, 85.52, 56.69, 23.69, 11.29, 51.44, 63.09, 65.65, 35.73, 60.15, 30.93, -4.2), type = 9)

var(c(47.44, 62.44, 20.44, 72.75, 77.86, 13.74, 28.2, 50.47, 59.19, 69.04))
var(c(49.31, 44.47, 14.04, 44.43, 49.18, 40.73, 44.65, 41.91, 80.38, 80.09))
sd(c(57.96, 20.81, 8.92, 14.03, 61.02, 25.69, 21.22, 49.56, 25.64, 28.31))
sd(c(76.22, 65, 19.69, 29.84, 37.18, 70.93, 64.78, 61.66, 49.03, 51.56, NA), na.rm = T)


IQR(c(80.94, 44.46, 46.33, 65.1, 66.42, 104.43, 53.15, 48.41, 12.88, 51.1, 43.03, 40.3, 33.71, 55.1, 22.17))
IQR(c(26.17, 97.73, 24.81, 53.62, 87.72, 45.19, 45.7, 69.63, 36.76, 7.17))
IQR(c(63.92, 35.85, 26.9, 48.92, 43.1, 66.94, 47.06, 56.54, 29.1, 58.88))

```
В некоторых случаях необходимо сначала создать собственную функцию, а затем применить ее к нескольким наборам данных:

```{r, message = FALSE}
average_mean_error <- function(x) {
  x <- x[!is.na(x)]
  return(sd(x)/sqrt(length(x)))
}

average_mean_error(c(47.44, 62.44, 20.44, 72.75, 77.86, 13.74, 28.2, 50.47, 59.19, 69.04))
average_mean_error(c(49.31, 44.47, 14.04, 44.43, 49.18, 40.73, 44.65, 41.91, 80.38, 80.09, NA))
average_mean_error(c(57.96, 20.81, 8.92, 14.03, 61.02, 25.69, 21.22, 49.56, 25.64, 28.31))
average_mean_error(c(76.22, 65, 19.69, 29.84, 37.18, 70.93, 64.78, 61.66, 49.03, 51.56))
```

## Более сложная работа с данными

### tibble вместо data.frame как формат данных
```{r, eval = FALSE}
tibble(`var 2` = 10:1, `var 3` = `var 1` - 10)
tibble(var_first = 1:10, var_first = ifelse(var_first < 5, var_first + 100, var_first))
tibble(`var 1` = 1:10, `var 2` = `var 1` * 100)
tibble(var_first = 1:10, var_second = ifelse(var_first < 5, var_first + 100, var_first))
tibble(var_1 = c(1:10) - 100, var_2 = "1:100")
```
### Выбор столбцов

```{r, eval = FALSE}
data %>% select(function(x) any(str_detect(x, "Жен")))
data %>% select(`Группа`, (function(x) is.factor(x)) | where(function(x) is.numeric(x)))
```

### Мутация переменных
Чтобы выполнить одно из заданий в разделе 6.6, проверим, работают ли 4 приведенные в нем команды. Первая команда работает корректно:
```{r}
data %>% mutate(across(!contains("E1"), function(x) str_c(x, " + некая строка")))
```
Вторая выдает ошибку:
```{r, eval = TRUE, error = TRUE}

data %>% mutate(across(!contains("E1") & !c(`Группа`, `Возраст`), function(x) x ^ 2))
```
Третья команда работает корректно, только если нужные столбцы сначала превращены в факторы:

```{r}
data$Пол <- factor(data$Пол)
data$`Группа крови` <- factor(data$`Группа крови`)

data %>% mutate(across(!contains("E1") & !c(`Группа`, `Возраст`) & !where(is.factor), function(x) x ^ 2), across(contains("E2"), function(x) x * 100))
```
Четвертая команда опять выдает ошибку
```{r, eval = TRUE, error = TRUE}
data %>% mutate(across(function(x) any(near(x, 0.5, tol = 0.1)), function(x) x + 1000))
```
